(window.webpackJsonp=window.webpackJsonp||[]).push([[7,9],{UIeC:function(t,e,n){"use strict";function r(){return r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},r.apply(this,arguments)}function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e){return i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},i(t,e)}function s(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=u(t);if(e){var o=u(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return l(this,n)}}function l(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function u(t){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},u(t)}n.r(e);var p,f,d,h,b,v,y,m,O,j,g,w,k,P,C,x=n("4Iz4"),_=n("3rgF"),S=n("lBHI"),I=n("jMw0"),M=n("jg5f"),U=n("Y3FI"),D=n("L8Yj"),R=n("vI8o"),F=n("rUzK"),T=n("d17u"),E=n("yqR5"),L=n("kv13"),z=n("DrMS"),A=n("3kvY"),B=function(t){function e(){var t;return(t=z.call(this)).followedUsers=new Set,t.followers=new Set,t.cart={},t.carts={},t.state={items:{}},t.id="profile",t.class="public-messages-view",t}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&i(t,e)}(e,t);var n,l,u,z=s(e);return n=e,l=[{key:"addToCart",value:function(t,e,n){n.stopPropagation();var r=(this.cart[t+e]||0)+1;S.a.local.get("cart").get(e).get(t).put(r)}},{key:"renderUserStore",value:function(t){var e,n=this,r=I.a.channels[t],o=r&&r.uuid,c=!(this.isMyProfile||t.length<40);return e=this.isMyProfile?Object(x.a)(p||(p=a(["<"," currentPhoto="," placeholder="," callback=","/>"])),M.a,this.state.photo,t,(function(t){return n.onProfilePhotoSet(t)})):this.state.photo?Object(x.a)(f||(f=a(["<",' class="profile-photo" src=',"/>"])),D.a,this.state.photo):Object(x.a)(d||(d=a(["<"," str="," width=250/>"])),L.a,t),Object(x.a)(h||(h=a(['\n      <div class="content">\n        <div class="profile-top">\n          <div class="profile-header">\n            <div class="profile-photo-container">\n              ','\n            </div>\n            <div class="profile-header-stuff">\n              <h3 class="profile-name"><'," path= "," placeholder= "," user=",'/></h3>\n              <div class="profile-about hidden-xs">\n                <p class="profile-about-content">\n                  <',' path="store/about" placeholder=',' attr="about" user=','/>\n                </p>\n              </div>\n              <div class="profile-actions">\n                <div class="follow-count">\n                  <a href="/follows/','">\n                    <span>',"</span> ",'\n                  </a>\n                  <a href="/followers/','">\n                    <span>',"</span> ","\n                  </a>\n                </div>\n                ","\n                ","\n                <button onClick=",">","</button>\n                ",'\n              </div>\n            </div>\n          </div>\n          <div class="profile-about visible-xs-flex">\n            <p class="profile-about-content" placeholder='," contenteditable="," onInput=",">","</p>\n          </div>\n        </div>\n\n        <h3>","</h3>\n        ","\n      </div>\n    "])),e,R.a,Object(_.c)("profile_name"),Object(_.c)("name"),t,R.a,Object(_.c)("store_description"),t,t,this.state.followedUserCount,Object(_.c)("following"),t,this.state.followerCount,Object(_.c)("followers"),this.followedUsers.has(I.a.getPubKey())?Object(x.a)(b||(b=a(["\n                  <p><small>","</small></p>\n                "])),Object(_.c)("follows_you")):"",c?Object(x.a)(v||(v=a(["<"," id=","/>"])),E.a,t):"",(function(){return Object(U.route)("/chat/".concat(t))}),Object(_.c)("send_message"),o?"":Object(x.a)(y||(y=a(["\n                  <"," text="," title="," copyStr=","/>\n                "])),T.a,Object(_.c)("copy_link"),this.state.name,window.location.href),this.isMyProfile?Object(_.c)("about"):"",this.isMyProfile,(function(t){return n.onAboutInput(t)}),this.state.about,Object(_.c)("store"),this.renderItems())}},{key:"renderItems",value:function(){var t=this,e=Object.keys(this.cart).reduce((function(e,n){return e+t.cart[n]}),0),n=Object.keys(this.state.items);return Object(x.a)(m||(m=a(["\n      ","\n      ",'\n      <div class="thumbnail-items">\n         ',"\n        ","\n        ","\n      </div>\n    "])),this.props.store||this.state.noFollows?"":Object(x.a)(O||(O=a(["<","/>"])),F.a),e?Object(x.a)(j||(j=a(["\n        <p>\n          <button onClick=",">","(",")</button>\n        </p>\n      "])),(function(){return Object(U.route)("/checkout")}),Object(_.c)("shopping_cart"),e):"",this.isMyProfile?Object(x.a)(g||(g=a(['\n          <div class="thumbnail-item store-item" onClick=','>\n            <a href="/product/new" class="name">',"</a>\n          </div>\n        "])),(function(){return Object(U.route)("/product/new")}),Object(_.c)("add_item")):"",n.length?"":Object(x.a)(w||(w=a(["<p> ","</p>"])),Object(_.c)("no_items_to_show")),n.map((function(e){var n=t.state.items[e];return Object(x.a)(k||(k=a(['\n            <div class="thumbnail-item store-item" onClick=',">\n              <"," src=",'/>\n              <a href="/product/',"/",'" class="name">',"</a>\n              ",'\n              <p class="description">','</p>\n              <p class="price">','</p>\n              <button class="add" onClick=',">\n              ","\n                ","\n              </button>\n            </div>\n          "])),(function(){return Object(U.route)("/product/".concat(e,"/").concat(n.from))}),D.a,n.photo||"",e,n.from||t.props.store,n.name,t.props.store?"":Object(x.a)(P||(P=a(["\n                <small>by <",' path="profile/name" editable="false" placeholder="Name" user=',"/></small>\n              "])),R.a,n.from),n.description,n.price,(function(r){return t.addToCart(e,n.from,r)}),Object(_.c)("add_to_cart"),t.cart[e]?" (".concat(t.cart[e],")"):"")})))}},{key:"renderView",value:function(){return this.props.store?this.renderUserStore(this.props.store):Object(x.a)(C||(C=a(["\n      <p dangerouslySetInnerHTML=","></p>\n      <"," />\n      ","\n    "])),{__html:Object(_.c)("this_is_a_prototype_store",'href="/store/'.concat(I.a.getPubKey(),'"'))},A.a,this.renderItems())}},{key:"updateTotalPrice",value:function(){var t=this,e=Object.keys(this.cart).reduce((function(e,n){var r=t.state.items[n];return e+(r&&parseInt(r.price)||0)*t.cart[n]}),0);this.setState({totalPrice:e})}},{key:"componentDidUpdate",value:function(t){t.store!==this.props.store&&this.componentDidMount()}},{key:"getCartFromUser",value:function(t){var e=this;S.a.local.get("cart").get(t).map(this.sub((function(n,r){"#"!==r&&(e.cart[r+t]=n,e.carts[t]=e.carts[t]||{},e.carts[t][r]=n,e.setState({cart:e.cart,carts:e.carts}),e.updateTotalPrice())}),"cart".concat(t)))}},{key:"onProduct",value:function(t,e,n,a,c){this.eventListeners["products".concat(c)]=a;var i=this.state.items;if(t&&"object"===o(t)){var s={};t.from=c,s[e]=t,r(i,s),this.updateTotalPrice()}else delete i[e];this.setState({items:i})}},{key:"getProductsFromUser",value:function(t){var e=this;S.a.public.user(t).get("store").get("products").map().on(this.sub((function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return e.onProduct.apply(e,r.concat([t]))}),"".concat(t,"products")))}},{key:"getAllCarts",value:function(){var t=this,e={};S.a.local.get("cart").map(this.sub((function(n,r){r?e[r]||(e[r]=!0,t.getCartFromUser(r)):delete e[r]})))}},{key:"getAllProducts",value:function(t){var e=this;S.a.group(t).map("store/products",this.sub((function(){e.onProduct.apply(e,arguments)})))}},{key:"componentDidMount",value:function(){var t,e=this,n=this.props.store;Object.values(this.eventListeners).forEach((function(t){return t.off()})),this.cart={},this.isMyProfile=I.a.getPubKey()===n,n?(this.getCartFromUser(n),this.getProductsFromUser(n)):(S.a.local.get("filters").get("group").on(this.sub((function(n){n&&n!==t&&(t=n,e.getAllProducts(n))}))),this.getAllCarts())}}],l&&c(n.prototype,l),u&&c(n,u),Object.defineProperty(n,"prototype",{writable:!1}),e}(z.a);e.default=B},x8GX:function(t,e,n){"use strict";function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function o(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e){return c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},c(t,e)}function i(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=l(t);if(e){var o=l(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return s(this,n)}}function s(t,e){if(e&&("object"===r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}n.r(e);var u,p,f,d,h,b,v,y,m,O=n("4Iz4"),j=n("lBHI"),g=n("jMw0"),w=n("Y3FI"),k=n("L8Yj"),P=n("UIeC"),C=n("3rgF"),x=n("vI8o");e.default=function(t){function e(){var t;return(t=l.call(this)).followedUsers=new Set,t.followers=new Set,t.state.paymentMethod="bitcoin",t.state.delivery={},t}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c(t,e)}(e,t);var n,r,s,l=i(e);return n=e,(r=[{key:"changeItemCount",value:function(t,e){this.cart[t]=Math.max(this.cart[t]+e,0),j.a.local.get("cart").get(this.props.store).get(t).put(this.cart[t])}},{key:"confirm",value:function(){var t=this,e=this.props.store;g.a.newChannel(e);var n={};Object.keys(this.cart).forEach((function(e){var r=t.cart[e];r&&(n[e]=r)})),g.a.channels[e].send({text:"New order: ".concat(JSON.stringify(n),", delivery: ").concat(JSON.stringify(this.state.delivery),", payment: ").concat(this.state.paymentMethod),order:!0}),j.a.local.get("cart").get(e).map((function(t,n){t&&j.a.local.get("cart").get(e).get(n).put(null)})),Object(w.route)("/chat/".concat(e))}},{key:"renderCart",value:function(){var t=this;return Object(O.a)(u||(u=o(['\n      <h3 class="side-padding-xs">','</h3>\n      <div class="flex-table">\n        ','\n        <div class="flex-row">\n          <div class="flex-cell"></div>\n          <div class="flex-cell no-flex"><b>'," ",' €</b></div>\n        </div>\n      </div>\n      <p class="side-padding-xs">\n        <button onClick=',">","</button>\n      </p>\n    "])),Object(C.c)("shopping_cart"),Object.keys(this.cart).filter((function(e){return!!t.cart[e]&&!!t.state.items[e]})).map((function(e){var n=t.state.items[e];return Object(O.a)(p||(p=o(['\n            <div class="flex-row">\n              <div class="flex-cell">\n                <a href=',">\n                  <"," src=","/>\n                  ",'\n                </a>\n              </div>\n              <div class="flex-cell no-flex price-cell">\n                <p>\n                  <span class="unit-price">'," €</span>\n                  <button onClick=",'>-</button>\n                  <input type="text" value='," onInput=","/>\n                  <button onClick=",'>+</button>\n                </p>\n                <span class="price">'," €</span>\n              </div>\n            </div>\n          "])),"/product/".concat(e,"/").concat(t.props.store),k.a,n.thumbnail,n.name||"item",parseInt(n.price),(function(){return t.changeItemCount(e,-1)}),t.cart[e],(function(){return t.changeItemCount(e,null)}),(function(){return t.changeItemCount(e,1)}),parseInt(n.price)*t.cart[e])})),Object(C.c)("total"),this.state.totalPrice,(function(){return t.setState({page:"delivery"})}),Object(C.c)("next"))}},{key:"renderDelivery",value:function(){var t=this;return Object(O.a)(f||(f=o(['\n      <div class="side-padding-xs">\n        <h3>','</h3>\n        <p>\n          <input type="text" placeholder='," value="," onInput=",'/>\n        </p>\n        <p>\n          <input type="text" placeholder='," value="," onInput=",'/>\n        </p>\n        <p>\n          <input type="text" placeholder='," value="," onInput=","/>\n        </p>\n        <button onClick=",">","</button>\n      </div>\n    "])),Object(C.c)("delivery"),Object(C.c)("name"),this.state.delivery.name,(function(t){return j.a.local.get("delivery").get("name").put(t.target.value)}),Object(C.c)("address"),this.state.delivery.address,(function(t){return j.a.local.get("delivery").get("address").put(t.target.value)}),Object(C.c)("email_optional"),this.state.delivery.email,(function(t){return j.a.local.get("delivery").get("email").put(t.target.value)}),(function(){return t.setState({page:"payment"})}),Object(C.c)("next"))}},{key:"paymentMethodChanged",value:function(t){var e=t.target.firstChild&&t.target.firstChild.value;e&&j.a.local.get("paymentMethod").put(e)}},{key:"renderPayment",value:function(){var t=this;return Object(O.a)(d||(d=o(['\n      <div class="side-padding-xs">\n        <h3>',':</h3>\n        <p>\n          <label for="bitcoin" onClick=','>\n            <input type="radio" name="payment" id="bitcoin" value="bitcoin" checked=','/>\n            Bitcoin\n          </label>\n        </p>\n        <p>\n          <label for="dogecoin" onClick=','>\n            <input type="radio" name="payment" id="dogecoin" value="dogecoin" checked=',"/>\n            Dogecoin\n          </label>\n        </p>\n        <button onClick=",">","</button>\n      </div>\n    "])),Object(C.c)("payment_method"),(function(e){return t.paymentMethodChanged(e)}),"bitcoin"===this.state.paymentMethod,(function(e){return t.paymentMethodChanged(e)}),"dogecoin"===this.state.paymentMethod,(function(){return t.setState({page:"confirmation"})}),Object(C.c)("next"))}},{key:"renderConfirmation",value:function(){var t=this;return Object(O.a)(h||(h=o(['\n      <h3 class="side-padding-xs">','</h3>\n      <div class="flex-table">\n        ','\n        <div class="flex-row">\n          <div class="flex-cell"></div>\n          <div class="flex-cell no-flex"><b>'," "," €</b></div>\n        </div>\n      </div>\n      <p>\n      ",":<br/>\n        ","<br/>\n        ","<br/>\n        ","\n      </p>\n      <p>",": <b>",'</b></p>\n      <p class="side-padding-xs"><button onClick=',">","</button></p>\n    "])),Object(C.c)("confirm"),Object.keys(this.cart).filter((function(e){return!!t.cart[e]&&!!t.state.items[e]})).map((function(e){var n=t.state.items[e];return Object(O.a)(b||(b=o(['\n            <div class="flex-row">\n              <div class="flex-cell">\n                <'," src=","/>\n                ",'\n              </div>\n              <div class="flex-cell no-flex price-cell">\n                <p>\n                  '," x ",' €\n                </p>\n                <span class="price">'," €</span>\n              </div>\n            </div>\n          "])),k.a,n.thumbnail,n.name||"item",t.cart[e],parseInt(n.price),parseInt(n.price)*t.cart[e])})),Object(C.c)("total"),this.state.totalPrice,Object(C.c)("delivery"),this.state.delivery.name,this.state.delivery.address,this.state.delivery.email,Object(C.c)("payment_method"),this.state.paymentMethod,(function(){return t.confirm()}),Object(C.c)("confirm_button"))}},{key:"renderCartList",value:function(){var t=this;return Object(O.a)(v||(v=o(['\n    <div class="main-view" id="profile">\n      <div class="content">\n        <h2>',"</h2>\n        ","\n      </div>\n    </div>"])),Object(C.c)("shopping_carts"),this.state.carts&&Object.keys(this.state.carts).map((function(e){var n=Object.keys(t.state.carts[e]).reduce((function(n,r){return n+t.state.carts[e][r]}),0);if(n)return Object(O.a)(y||(y=o(['\n            <p>\n              <a href="/checkout/','">\n                <'," path= "," user=",' editable="false"/> (',")\n              </a>\n            </p>\n          "])),e,x.a,Object(C.c)("profile_name"),e,n)})))}},{key:"render",value:function(){var t,e=this;if(!this.props.store)return this.renderCartList();var n=this.state.page;return t="delivery"===n?this.renderDelivery():"confirmation"===n?this.renderConfirmation():"payment"===n?this.renderPayment():this.renderCart(),Object(O.a)(m||(m=o(['\n    <div class="main-view" id="profile">\n      <div class="content">\n        <p>\n          <a href="/store/','"><',' path="profile/name" user=','/></a>\n        </p>\n        <div id="store-steps">\n          <div class='," onClick=",">","</div>\n          <div class="," onClick=",">","</div>\n          <div class="," onClick=",">","</div>\n          <div class="," onClick=",">","</div>\n        </div>\n        ","\n      </div>\n    </div>"])),this.props.store,x.a,this.props.store,"cart"===n?"active":"",(function(){return e.setState({page:"cart"})}),Object(C.c)("shopping_cart"),"delivery"===n?"active":"",(function(){return e.setState({page:"delivery"})}),Object(C.c)("delivery"),"payment"===n?"active":"",(function(){return e.setState({page:"payment"})}),Object(C.c)("payment"),"confirmation"===n?"active":"",(function(){return e.setState({page:"confirmation"})}),Object(C.c)("confirm"),t)}},{key:"componentDidUpdate",value:function(t){t.store!==this.props.store&&this.componentDidMount()}},{key:"componentDidMount",value:function(){var t=this;P.default.prototype.componentDidMount.call(this),Object.values(this.eventListeners).forEach((function(t){return t.off()})),this.eventListeners=[];var e=this.props.store;this.carts={},e?(this.setState({page:"cart"}),j.a.local.get("cart").get(e).map((function(e,n){t.cart[n]=e,t.setState({cart:t.cart})})),j.a.local.get("paymentMethod").on((function(e){return t.setState({paymentMethod:e})})),j.a.local.get("delivery").open((function(e){return t.setState({delivery:e})}))):this.getAllCarts()}}])&&a(n.prototype,r),s&&a(n,s),Object.defineProperty(n,"prototype",{writable:!1}),e}(P.default)}}]);
//# sourceMappingURL=7.chunk.6f5d6.js.map