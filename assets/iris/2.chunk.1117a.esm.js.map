{"version":3,"sources":["webpack:///./js/components/ExplorerNode.js","webpack:///./js/views/Explorer.js"],"names":["hashRegex","pubKeyRegex","chevronDown","html","chevronRight","ExplorerNode","BaseComponent","constructor","super","this","children","state","groups","shownChildrenCount","getNode","props","path","length","indexOf","replace","split","slice","reduce","sum","current","get","decodeURIComponent","gun","shouldComponentUpdate","componentDidMount","isMine","Session","getPubKey","isGroup","isPublicRoot","isUserList","isGroupRoot","isLocal","value","_","displayName","Users","obj","State","local","map","sub","v","k","setState","cb","async","c","e","from","substr","match","encryption","myKey","getKey","dec","Gun","SEA","decrypt","undefined","mySecret","secret","epub","join","onChildObjectClick","preventDefault","open","onShowMoreClick","showMore","renderChildObject","encodeURIComponent","indent","Name","renderChildValue","s","decrypted","lnk","href","text","cls","keyLinks","JSON","stringify","pub","showToggle","stringified","valueLinks","Text","onExpandClicked","expandAll","Object","keys","forEach","onNewItemSubmit","newItemName","name","trim","newItemType","put","a","onNewItemNameInput","target","trimStart","showNewItemClicked","type","setTimeout","document","querySelector","focus","render","childrenKeys","sort","myKeyIndex","splice","unshift","showMoreBtn","showTools","group","renderChildren","Explorer","View","renderView","node","scope","public","isRootLevel","pathString","i","isPubKey","t","publicOpen","groupOpen","localOpen"],"mappings":"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","file":"2.chunk.1117a.esm.js","sourcesContent":["import BaseComponent from \"../BaseComponent\";\nimport Session from \"../Session\";\nimport Gun from \"gun\";\nimport {html} from \"htm/preact\";\nimport Name from \"./Name\";\nimport State from \"../State\";\nimport Text from \"./Text\";\n\nconst hashRegex = /^(?:[A-Za-z0-9+/]{4}){10}(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)+$/;\nconst pubKeyRegex = /^[A-Za-z0-9\\-\\_]{40,50}\\.[A-Za-z0-9\\_\\-]{40,50}$/;\nconst SHOW_CHILDREN_COUNT = 50;\n\nconst chevronDown = html`\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" fill=\"currentColor\" class=\"bi bi-chevron-down\" viewBox=\"0 0 16 16\">\n  <path fill-rule=\"evenodd\" d=\"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z\"/>\n</svg>\n`;\n\nconst chevronRight = html`\n<svg width=\"12\" height=\"12\" fill=\"currentColor\" viewBox=\"0 0 16 16\">\n  <path fill-rule=\"evenodd\" d=\"M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z\"/>\n</svg>\n`;\n\nclass ExplorerNode extends BaseComponent {\n  constructor() {\n    super();\n    this.children = [];\n    this.state = {groups:{}, children: {}, shownChildrenCount: SHOW_CHILDREN_COUNT};\n  }\n\n  getNode() {\n    if (this.props.path.length > 1) {\n      let path = this.props.path;\n      if (path.indexOf('Public/Users') === 0) {\n        path = path.replace('/Users', '');\n      }\n      path = path.split('/');\n      return path.slice(1).reduce((sum, current) => (current && sum.get(decodeURIComponent(current))) || sum, this.props.gun);\n    }\n    return this.props.gun;\n  }\n\n  shouldComponentUpdate() {\n    return true;\n  }\n\n  componentDidMount() { // TODO: this is messy; create separate classes for Public / Group / Local\n    this.isMine = this.props.path.indexOf(`Public/Users/~${  Session.getPubKey()}`) === 0;\n    this.isGroup = this.props.path.indexOf('Group/') === 0;\n    this.isPublicRoot = this.props.path === 'Public';\n    this.isUserList = this.props.path === 'Public/Users';\n    this.isGroupRoot = this.props.path === 'Group';\n    this.isLocal = this.props.path.indexOf('Local') === 0;\n\n    this.children = {};\n    if (this.props.children && typeof this.props.children === \"object\") {\n      this.children = Object.assign(this.children, this.props.children);\n    }\n    if (this.isPublicRoot) {\n      this.children = Object.assign(this.children, {\n        '#':{value:{_:1}, displayName: \"ContentAddressed\"},\n        Users:{value:{_:1}}\n      });\n    }\n    if (this.isUserList) { // always add yourself to the user list\n      const obj = {};\n      obj[`~${Session.getPubKey()}`] = {value:{_:1}};\n      this.children = Object.assign(this.children, obj);\n    }\n    if (this.isGroupRoot) {\n      const groups = {};\n      State.local.get('groups').map(this.sub(\n        (v,k) => {\n          if (v) {\n            groups[k] = true;\n          } else {\n            delete groups[k];\n          }\n          this.setState({groups});\n        }\n      ));\n    }\n    this.setState({children: this.children, shownChildrenCount: SHOW_CHILDREN_COUNT});\n\n    const cb = this.sub(\n      async (v, k, c, e, from) => {\n        if (k === '_') { return; }\n        if (this.isPublicRoot && k.indexOf('~') === 0) { return; }\n        if (this.isUserList && !k.substr(1).match(pubKeyRegex)) { return; }\n        let encryption;\n        if (typeof v === 'string' && v.indexOf('SEA{') === 0) {\n          try {\n            const myKey = Session.getKey();\n            let dec = await Gun.SEA.decrypt(v, myKey);\n            if (dec === undefined) {\n              if (!this.mySecret) {\n                this.mySecret = await Gun.SEA.secret(myKey.epub, myKey);\n                dec = await Gun.SEA.decrypt(v, this.mySecret);\n              }\n            }\n            if (dec !== undefined) {\n              v = dec;\n              encryption = 'Decrypted';\n            } else {\n              encryption = 'Encrypted';\n            }\n          } catch(e) {\n            null;\n          }\n        }\n        const prev = this.children[k] || {};\n        this.children[k] = Object.assign(prev, { value: v, encryption, from });\n        this.setState({children: this.children});\n      }\n    );\n\n    if (this.isGroupRoot) {\n      return;\n    } else if (this.isGroup) {\n      const path = this.props.path.split('/').slice(2).join('/');\n      this.props.gun.map(path, cb); // TODO: make State.group() provide the normal gun api\n    } else {\n      this.getNode().map(cb);\n    }\n  }\n\n  onChildObjectClick(e, k) {\n    e.preventDefault();\n    this.children[k].open = !this.children[k].open;\n    this.setState({children: this.children});\n  }\n\n  onShowMoreClick(e, k) {\n    e.preventDefault();\n    this.children[k].showMore = !this.children[k].showMore;\n    this.setState({children: this.children});\n  }\n\n  renderChildObject(k, displayName) {\n    const path = `${this.props.path  }/${  encodeURIComponent(k)}`;\n    const substr = k.substr(1);\n    return html`\n      <div class=\"explorer-row\" style=\"padding-left: ${this.props.indent}em\">\n        <span onClick=${e => this.onChildObjectClick(e, k)}>${this.state.children[k].open ? chevronDown : chevronRight}</span>\n        <a href=\"/explorer/${encodeURIComponent(path)}\">\n            <b>\n                ${typeof k === 'string' && substr.match(pubKeyRegex) ?\n                        html`<${Name} key=${k} pub=${substr} placeholder=\"user\"/>` :\n                        (displayName || k)}\n            </b>\n        </a>\n        ${Session.getPubKey() === substr ? html`<small class=\"mar-left5\">(you)</small>` : ''}\n      </div>\n      ${this.state.children[k].open ? html`<${ExplorerNode} gun=${this.props.gun} indent=${this.props.indent + 1} key=${path} path=${path} isGroup=${this.props.isGroup}/>` : ''}\n    `;\n  }\n\n  renderChildValue(k, v) {\n    let s;\n    const encryption = this.children[k].encryption;\n    const from = this.children[k].from;\n    const decrypted = encryption === 'Decrypted';\n    const lnk = (href, text, cls) => html`<a class=${cls === undefined ? \"mar-left5\" : cls} href=${href}>${text}</a>`;\n    const keyLinks = html`\n      ${typeof k === 'string' && k.match(hashRegex) ? lnk(`/post/${encodeURIComponent(k)}`, '#') : ''}\n      ${typeof k === 'string' && k.match(pubKeyRegex) ? lnk(`/explorer/Public%2F~${encodeURIComponent(encodeURIComponent(k))}`, html`<${Name} key=${k} pub=${k} placeholder=\"user\"/>`) : ''}\n    `;\n    if (encryption) {\n      if (!decrypted) {\n        s = html`<i>Encrypted value</i>`;\n      } else {\n        s = JSON.stringify(v);\n      }\n    } else {\n      const pub = Session.getPubKey();\n      const path = (this.isMine || this.isLocal) && (`${this.props.path  }/${  encodeURIComponent(k)}`)\n        .replace(`Public/Users/~${  pub  }/`, '')\n        .replace(`Local/`, '');\n\n      if (typeof v === 'string' && v.indexOf('data:image') === 0) {\n        s = this.isMine ? html`<iris-img user=${pub} path=${path}/>` : html`<img src=${v}/>`;\n      } else {\n        let stringified = JSON.stringify(v);\n        let showToggle;\n        if (stringified.length > 100) {\n          showToggle = true;\n          if (!this.state.children[k].showMore) {\n            stringified = stringified.slice(0, 100);\n          }\n        }\n\n        const valueLinks = html`\n          ${typeof v === 'string' && v.match(hashRegex) ? lnk(`/post/${encodeURIComponent(v)}`, '#') : ''}\n          ${k !== 'epub' && typeof v === 'string' && v.match(pubKeyRegex) ? lnk(`/explorer/Public%2F~${encodeURIComponent(encodeURIComponent(v))}`, html`<${Name} key=${v} pub=${v} placeholder=\"user\"/>`) : ''}\n          ${typeof from === 'string' ? html`<small> from ${lnk(`/explorer/Public%2F~${encodeURIComponent(encodeURIComponent(from))}`, html`<${Name} key=${from} pub=${from} placeholder=\"user\"/>`, '')}</small>` : ''}\n        `;\n\n        // TODO: || isGroup where you're participating\n        s = this.isMine || this.isLocal ? html`\n          <${Text} gun=${this.props.gun} placeholder=\"empty\" key=${path} user=${this.isLocal ? null : pub} path=${path} editable=${true} json=${true}/>\n          ${valueLinks}\n        ` :\n        html`\n          <span class=${typeof v === 'string' ? '' : 'iris-non-string'}>\n            ${stringified}\n            ${showToggle ? html`\n              <a onClick=${e => this.onShowMoreClick(e, k)} href=\"\">${this.state.children[k].showMore ? 'less' : 'more'}</a>\n            ` : ''}\n            ${valueLinks}\n          </span>\n        `;\n      }\n    }\n    return html`\n      <div class=\"explorer-row\" style=\"padding-left: ${this.props.indent}em\">\n        <b class=\"val\">${k} ${keyLinks}</b>:\n        ${encryption ? html`\n          <span class=\"tooltip\"><span class=\"tooltiptext\">${encryption} value</span>\n            ${decrypted ? '🔓' : ''}\n          </span>\n        ` : ''} ${s}\n      </div>\n    `;\n  }\n\n  onExpandClicked() {\n    const expandAll = !this.state.expandAll;\n    Object.keys(this.children).forEach(k => {\n      this.children[k].open = expandAll;\n    });\n    this.setState({expandAll, children: this.children});\n  }\n\n  onNewItemSubmit(e) {\n    e.preventDefault();\n    if (this.state.newItemName) {\n      let name = this.state.newItemName.trim();\n      if (this.state.newItemType === 'object') {\n        this.getNode().get(name).put({a:null});\n      } else {\n        this.getNode().get(name).put('');\n      }\n      this.setState({newItemType: false, newItemName: ''});\n    }\n  }\n\n  onNewItemNameInput(e) {\n    this.setState({newItemName: e.target.value.trimStart().replace('  ', ' ')});\n  }\n\n  showNewItemClicked(type) {\n    this.setState({newItemType:type});\n    setTimeout(() => document.querySelector('#newItemNameInput').focus(), 0);\n  }\n\n  render() {\n    const childrenKeys = Object.keys(this.state.children).sort();\n    const myKeyIndex = childrenKeys.indexOf(`~${Session.getPubKey()}`);\n    if (myKeyIndex > 0) {\n      const a = childrenKeys.splice(myKeyIndex, 1);\n      childrenKeys.unshift(a[0]);\n    }\n\n    const renderChildren = children => {\n      return children.map(k => {\n        const v = this.state.children[k].value;\n        const n = this.state.children[k].displayName;\n        if (typeof v === 'object' && v && v['_']) {\n          return this.renderChildObject(k, n);\n        }\n          return this.renderChildValue(k, v);\n\n      });\n    }\n\n    const showMoreBtn = childrenKeys.length > this.state.shownChildrenCount;\n    return html`\n      ${this.props.indent === 0 ? html`\n        <div class=\"explorer-row\" style=\"padding-left: ${this.props.indent}em\">\n          ${this.props.showTools ? html`\n            <p class=\"explorer-tools\">\n              <a onClick=${() => this.onExpandClicked()}>${this.state.expandAll ? 'Close all' : 'Expand all'}</a>\n              <a onClick=${() => this.showNewItemClicked('object')}>New object</a>\n              <a onClick=${() => this.showNewItemClicked('value')}>New value</a>\n              ${childrenKeys.length} items\n            </p>\n          `: ''}\n          ${this.state.newItemType ? html`\n            <p>\n              <form onSubmit=${(e) => this.onNewItemSubmit(e)}>\n                <input id=\"newItemNameInput\" type=\"text\" onInput=${e => this.onNewItemNameInput(e)} value=${this.state.newItemName} placeholder=\"New ${this.state.newItemType} name\"/>\n                <button type=\"submit\">Create</button>\n                <button onClick=${() => this.setState({newItemType: false})}>Cancel</button>\n              </form>\n            </p>\n          ` : ''}\n        </div>\n      `: ''}\n      \n      ${this.isGroupRoot ? Object.keys(this.state.groups).map(group => html`\n          <div class=\"explorer-row\" style=\"padding-left: 1em\">\n              ${chevronRight}\n              <a href=\"/explorer/Group%2F${encodeURIComponent(encodeURIComponent(group))}\"><b>${group}</b></a>\n          </div>\n      `) : renderChildren(childrenKeys.slice(0, this.state.shownChildrenCount))}\n      \n      ${showMoreBtn ? html`\n        <a style=\"padding-left: ${this.props.indent + 1}em\" href=\"\" onClick=${e => {e.preventDefault();this.setState({shownChildrenCount: this.state.shownChildrenCount + SHOW_CHILDREN_COUNT})}}>More (${childrenKeys.length - this.state.shownChildrenCount})</a>\n      ` : ''}\n    `;\n  }\n}\n\nexport default ExplorerNode;","import { html } from 'htm/preact';\nimport State from '../State';\nimport View from './View';\nimport ExplorerNode from '../components/ExplorerNode';\nimport { translate as t } from '../Translation';\nimport Name from '../components/Name';\n\nconst pubKeyRegex = /^[A-Za-z0-9\\-\\_]{40,50}\\.[A-Za-z0-9\\_\\-]{40,50}$/;\n\nconst chevronDown = html`\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" fill=\"currentColor\" class=\"bi bi-chevron-down\" viewBox=\"0 0 16 16\">\n  <path fill-rule=\"evenodd\" d=\"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z\"/>\n</svg>\n`;\n\nconst chevronRight = html`\n<svg width=\"12\" height=\"12\" fill=\"currentColor\" viewBox=\"0 0 16 16\">\n  <path fill-rule=\"evenodd\" d=\"M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z\"/>\n</svg>\n`;\n\nclass Explorer extends View {\n  renderView() {\n    const split = (this.props.node || '').split('/');\n    const scope = split.length && split[0];\n    let gun = State.public;\n    if (scope === 'Local') {\n      gun = State.local;\n    } else if (scope === 'Group') {\n      const group = (split.length >= 2) && split[1];\n      gun = State.group(group || undefined);\n    }\n    const isRootLevel = !split[0].length;\n    const pathString = split.map((k, i) => {\n      k = decodeURIComponent(k);\n      const substr = k.substr(1);\n      const isPubKey = substr.match(pubKeyRegex);\n      return html`\n        ${chevronRight} <a href=\"/explorer/${encodeURIComponent(split.slice(0,i+1).join('/'))}\">\n            ${isPubKey ? html`<${Name} key=${substr} pub=${substr} placeholder=\"profile name\" />` : k}\n        </a>\n        ${isPubKey ? html`<small> (<a href=\"/profile/${substr}\">${t('profile')}</a>)</small>`: ''}\n      `\n    });\n    const s = this.state;\n    return html`\n      <p>\n        <a href=\"/explorer\">All</a> ${split[0].length ? pathString : ''}\n        ${isRootLevel ? html `<small class=\"mar-left5\">Iris raw data.</small>` : ''}\n      </p>\n      ${isRootLevel ? html`\n        <div class=\"explorer-row\">\n            <span onClick=${() => this.setState({publicOpen:!s.publicOpen})}>${s.publicOpen ? chevronDown : chevronRight}</span>\n            <a href=\"/explorer/Public\"><b>Public</b></a>\n            <small class=\"mar-left5\">(synced with peers)</small>\n        </div>\n        ${s.publicOpen ? html`<${ExplorerNode} indent=${1} gun=${State.public} key='Public' path='Public'/>`:''}\n        <div class=\"explorer-row\">\n            <span onClick=${() => this.setState({groupOpen:!s.groupOpen})}>${s.groupOpen ? chevronDown : chevronRight}</span>\n            <a href=\"/explorer/Group\"><b>Group</b></a>\n            <small class=\"mar-left5\">(public data, composite object of all the users in the <a href=\"/explorer/Local%2Fgroups\">group</a>)</small>\n        </div>\n        ${s.groupOpen ? html`<${ExplorerNode} indent=${1} gun=${State.public} key='Group' path='Group'/>`:''}\n        <div class=\"explorer-row\">\n            <span onClick=${() => this.setState({localOpen:!s.localOpen})}>${s.localOpen ? chevronDown : chevronRight}</span>\n            <a href=\"/explorer/Local\"><b>Local</b></a>\n            <small class=\"mar-left5\">(only stored on your device)</small>\n        </div>\n        ${s.localOpen ? html`<${ExplorerNode} indent=${1} gun=${State.local} key=\"Local\" path='Local'/>`:''}\n      `: html`\n        <${ExplorerNode} indent=${0} showTools=${true} gun=${gun} key=${this.props.node} path=${this.props.node}/>\n      `}\n    `;\n  }\n}\n\nexport default Explorer;\n"],"sourceRoot":""}