(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{UIeC:function(t,e,n){"use strict";function r(){return r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},r.apply(this,arguments)}function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function c(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function s(t,e){return s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},s(t,e)}function i(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=l(t);if(e){var o=l(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return u(this,n)}}function u(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}n.r(e);var p,f,h,b,d,v,y,m,j,O,g,w,P,k,_,S=n("4Iz4"),C=n("3rgF"),U=n("lBHI"),I=n("jMw0"),M=n("jg5f"),F=n("Y3FI"),T=n("L8Yj"),R=n("vI8o"),x=n("rUzK"),A=n("d17u"),D=n("yqR5"),z=n("kv13"),E=n("DrMS"),K=n("3kvY"),L=function(t){function e(){var t;return(t=E.call(this)).followedUsers=new Set,t.followers=new Set,t.cart={},t.carts={},t.state={items:{}},t.id="profile",t.class="public-messages-view",t}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e)}(e,t);var n,u,l,E=i(e);return n=e,u=[{key:"addToCart",value:function(t,e,n){n.stopPropagation();var r=(this.cart[t+e]||0)+1;U.a.local.get("cart").get(e).get(t).put(r)}},{key:"renderUserStore",value:function(t){var e,n=this,r=I.a.channels[t],o=r&&r.uuid,a=!(this.isMyProfile||t.length<40);return e=this.isMyProfile?Object(S.a)(p||(p=c(["<"," currentPhoto="," placeholder="," callback=","/>"])),M.a,this.state.photo,t,(function(t){return n.onProfilePhotoSet(t)})):this.state.photo?Object(S.a)(f||(f=c(["<",' class="profile-photo" src=',"/>"])),T.a,this.state.photo):Object(S.a)(h||(h=c(["<"," str="," width=250/>"])),z.a,t),Object(S.a)(b||(b=c(['\n      <div class="content">\n        <div class="profile-top">\n          <div class="profile-header">\n            <div class="profile-photo-container">\n              ','\n            </div>\n            <div class="profile-header-stuff">\n              <h3 class="profile-name"><'," path= "," placeholder= "," user=",'/></h3>\n              <div class="profile-about hidden-xs">\n                <p class="profile-about-content">\n                  <',' path="store/about" placeholder=',' attr="about" user=','/>\n                </p>\n              </div>\n              <div class="profile-actions">\n                <div class="follow-count">\n                  <a href="/follows/','">\n                    <span>',"</span> ",'\n                  </a>\n                  <a href="/followers/','">\n                    <span>',"</span> ","\n                  </a>\n                </div>\n                ","\n                ","\n                <button onClick=",">","</button>\n                ",'\n              </div>\n            </div>\n          </div>\n          <div class="profile-about visible-xs-flex">\n            <p class="profile-about-content" placeholder='," contenteditable="," onInput=",">","</p>\n          </div>\n        </div>\n\n        <h3>","</h3>\n        ","\n      </div>\n    "])),e,R.a,Object(C.c)("profile_name"),Object(C.c)("name"),t,R.a,Object(C.c)("store_description"),t,t,this.state.followedUserCount,Object(C.c)("following"),t,this.state.followerCount,Object(C.c)("followers"),this.followedUsers.has(I.a.getPubKey())?Object(S.a)(d||(d=c(["\n                  <p><small>","</small></p>\n                "])),Object(C.c)("follows_you")):"",a?Object(S.a)(v||(v=c(["<"," id=","/>"])),D.a,t):"",(function(){return Object(F.route)("/chat/".concat(t))}),Object(C.c)("send_message"),o?"":Object(S.a)(y||(y=c(["\n                  <"," text="," title="," copyStr=","/>\n                "])),A.a,Object(C.c)("copy_link"),this.state.name,window.location.href),this.isMyProfile?Object(C.c)("about"):"",this.isMyProfile,(function(t){return n.onAboutInput(t)}),this.state.about,Object(C.c)("store"),this.renderItems())}},{key:"renderItems",value:function(){var t=this,e=Object.keys(this.cart).reduce((function(e,n){return e+t.cart[n]}),0),n=Object.keys(this.state.items);return Object(S.a)(m||(m=c(["\n      ","\n      ",'\n      <div class="thumbnail-items">\n         ',"\n        ","\n        ","\n      </div>\n    "])),this.props.store||this.state.noFollows?"":Object(S.a)(j||(j=c(["<","/>"])),x.a),e?Object(S.a)(O||(O=c(["\n        <p>\n          <button onClick=",">","(",")</button>\n        </p>\n      "])),(function(){return Object(F.route)("/checkout")}),Object(C.c)("shopping_cart"),e):"",this.isMyProfile?Object(S.a)(g||(g=c(['\n          <div class="thumbnail-item store-item" onClick=','>\n            <a href="/product/new" class="name">',"</a>\n          </div>\n        "])),(function(){return Object(F.route)("/product/new")}),Object(C.c)("add_item")):"",n.length?"":Object(S.a)(w||(w=c(["<p> ","</p>"])),Object(C.c)("no_items_to_show")),n.map((function(e){var n=t.state.items[e];return Object(S.a)(P||(P=c(['\n            <div class="thumbnail-item store-item" onClick=',">\n              <"," src=",'/>\n              <a href="/product/',"/",'" class="name">',"</a>\n              ",'\n              <p class="description">','</p>\n              <p class="price">','</p>\n              <button class="add" onClick=',">\n              ","\n                ","\n              </button>\n            </div>\n          "])),(function(){return Object(F.route)("/product/".concat(e,"/").concat(n.from))}),T.a,n.photo||"",e,n.from||t.props.store,n.name,t.props.store?"":Object(S.a)(k||(k=c(["\n                <small>by <",' path="profile/name" editable="false" placeholder="Name" user=',"/></small>\n              "])),R.a,n.from),n.description,n.price,(function(r){return t.addToCart(e,n.from,r)}),Object(C.c)("add_to_cart"),t.cart[e]?" (".concat(t.cart[e],")"):"")})))}},{key:"renderView",value:function(){return this.props.store?this.renderUserStore(this.props.store):Object(S.a)(_||(_=c(["\n      <p dangerouslySetInnerHTML=","></p>\n      <"," />\n      ","\n    "])),{__html:Object(C.c)("this_is_a_prototype_store",'href="/store/'.concat(I.a.getPubKey(),'"'))},K.a,this.renderItems())}},{key:"updateTotalPrice",value:function(){var t=this,e=Object.keys(this.cart).reduce((function(e,n){var r=t.state.items[n];return e+(r&&parseInt(r.price)||0)*t.cart[n]}),0);this.setState({totalPrice:e})}},{key:"componentDidUpdate",value:function(t){t.store!==this.props.store&&this.componentDidMount()}},{key:"getCartFromUser",value:function(t){var e=this;U.a.local.get("cart").get(t).map(this.sub((function(n,r){"#"!==r&&(e.cart[r+t]=n,e.carts[t]=e.carts[t]||{},e.carts[t][r]=n,e.setState({cart:e.cart,carts:e.carts}),e.updateTotalPrice())}),"cart".concat(t)))}},{key:"onProduct",value:function(t,e,n,c,a){this.eventListeners["products".concat(a)]=c;var s=this.state.items;if(t&&"object"===o(t)){var i={};t.from=a,i[e]=t,r(s,i),this.updateTotalPrice()}else delete s[e];this.setState({items:s})}},{key:"getProductsFromUser",value:function(t){var e=this;U.a.public.user(t).get("store").get("products").map().on(this.sub((function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return e.onProduct.apply(e,r.concat([t]))}),"".concat(t,"products")))}},{key:"getAllCarts",value:function(){var t=this,e={};U.a.local.get("cart").map(this.sub((function(n,r){r?e[r]||(e[r]=!0,t.getCartFromUser(r)):delete e[r]})))}},{key:"getAllProducts",value:function(t){var e=this;U.a.group(t).map("store/products",this.sub((function(){e.onProduct.apply(e,arguments)})))}},{key:"componentDidMount",value:function(){var t,e=this,n=this.props.store;Object.values(this.eventListeners).forEach((function(t){return t.off()})),this.cart={},this.isMyProfile=I.a.getPubKey()===n,n?(this.getCartFromUser(n),this.getProductsFromUser(n)):(U.a.local.get("filters").get("group").on(this.sub((function(n){n&&n!==t&&(t=n,e.getAllProducts(n))}))),this.getAllCarts())}}],u&&a(n.prototype,u),l&&a(n,l),Object.defineProperty(n,"prototype",{writable:!1}),e}(E.a);e.default=L}}]);
//# sourceMappingURL=9.chunk.dcf87.js.map