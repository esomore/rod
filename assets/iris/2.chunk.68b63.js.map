{"version":3,"sources":["webpack:///./js/components/ExplorerNode.js","webpack:///./js/views/Explorer.js"],"names":["hashRegex","pubKeyRegex","chevronDown","html","chevronRight","ExplorerNode","children","state","groups","shownChildrenCount","this","props","path","length","indexOf","replace","split","slice","reduce","sum","current","get","decodeURIComponent","gun","isMine","Session","getPubKey","isGroup","isPublicRoot","isUserList","isGroupRoot","isLocal","value","_","displayName","Users","obj","State","local","map","sub","v","k","setState","cb","c","e","from","substr","match","encryption","myKey","getKey","dec","Gun","SEA","decrypt","undefined","mySecret","secret","epub","join","getNode","preventDefault","open","showMore","encodeURIComponent","indent","onChildObjectClick","Name","s","decrypted","lnk","href","text","cls","keyLinks","JSON","stringify","pub","showToggle","stringified","valueLinks","Text","onShowMoreClick","expandAll","Object","keys","forEach","newItemName","name","trim","newItemType","put","a","target","trimStart","type","setTimeout","document","querySelector","focus","childrenKeys","sort","myKeyIndex","splice","unshift","showMoreBtn","showTools","onExpandClicked","showNewItemClicked","onNewItemSubmit","onNewItemNameInput","group","n","renderChildObject","renderChildValue","BaseComponent","Explorer","node","scope","public","isRootLevel","pathString","i","isPubKey","t","publicOpen","groupOpen","localOpen","View"],"mappings":"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","file":"2.chunk.68b63.js","sourcesContent":["import BaseComponent from \"../BaseComponent\";\nimport Session from \"../Session\";\nimport Gun from \"gun\";\nimport {html} from \"htm/preact\";\nimport Name from \"./Name\";\nimport State from \"../State\";\nimport Text from \"./Text\";\n\nconst hashRegex = /^(?:[A-Za-z0-9+/]{4}){10}(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)+$/;\nconst pubKeyRegex = /^[A-Za-z0-9\\-\\_]{40,50}\\.[A-Za-z0-9\\_\\-]{40,50}$/;\nconst SHOW_CHILDREN_COUNT = 50;\n\nconst chevronDown = html`\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" fill=\"currentColor\" class=\"bi bi-chevron-down\" viewBox=\"0 0 16 16\">\n  <path fill-rule=\"evenodd\" d=\"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z\"/>\n</svg>\n`;\n\nconst chevronRight = html`\n<svg width=\"12\" height=\"12\" fill=\"currentColor\" viewBox=\"0 0 16 16\">\n  <path fill-rule=\"evenodd\" d=\"M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z\"/>\n</svg>\n`;\n\nclass ExplorerNode extends BaseComponent {\n  constructor() {\n    super();\n    this.children = [];\n    this.state = {groups:{}, children: {}, shownChildrenCount: SHOW_CHILDREN_COUNT};\n  }\n\n  getNode() {\n    if (this.props.path.length > 1) {\n      let path = this.props.path;\n      if (path.indexOf('Public/Users') === 0) {\n        path = path.replace('/Users', '');\n      }\n      path = path.split('/');\n      return path.slice(1).reduce((sum, current) => (current && sum.get(decodeURIComponent(current))) || sum, this.props.gun);\n    }\n    return this.props.gun;\n  }\n\n  shouldComponentUpdate() {\n    return true;\n  }\n\n  componentDidMount() { // TODO: this is messy; create separate classes for Public / Group / Local\n    this.isMine = this.props.path.indexOf(`Public/Users/~${  Session.getPubKey()}`) === 0;\n    this.isGroup = this.props.path.indexOf('Group/') === 0;\n    this.isPublicRoot = this.props.path === 'Public';\n    this.isUserList = this.props.path === 'Public/Users';\n    this.isGroupRoot = this.props.path === 'Group';\n    this.isLocal = this.props.path.indexOf('Local') === 0;\n\n    this.children = {};\n    if (this.props.children && typeof this.props.children === \"object\") {\n      this.children = Object.assign(this.children, this.props.children);\n    }\n    if (this.isPublicRoot) {\n      this.children = Object.assign(this.children, {\n        '#':{value:{_:1}, displayName: \"ContentAddressed\"},\n        Users:{value:{_:1}}\n      });\n    }\n    if (this.isUserList) { // always add yourself to the user list\n      const obj = {};\n      obj[`~${Session.getPubKey()}`] = {value:{_:1}};\n      this.children = Object.assign(this.children, obj);\n    }\n    if (this.isGroupRoot) {\n      const groups = {};\n      State.local.get('groups').map(this.sub(\n        (v,k) => {\n          if (v) {\n            groups[k] = true;\n          } else {\n            delete groups[k];\n          }\n          this.setState({groups});\n        }\n      ));\n    }\n    this.setState({children: this.children, shownChildrenCount: SHOW_CHILDREN_COUNT});\n\n    const cb = this.sub(\n      async (v, k, c, e, from) => {\n        if (k === '_') { return; }\n        if (this.isPublicRoot && k.indexOf('~') === 0) { return; }\n        if (this.isUserList && !k.substr(1).match(pubKeyRegex)) { return; }\n        let encryption;\n        if (typeof v === 'string' && v.indexOf('SEA{') === 0) {\n          try {\n            const myKey = Session.getKey();\n            let dec = await Gun.SEA.decrypt(v, myKey);\n            if (dec === undefined) {\n              if (!this.mySecret) {\n                this.mySecret = await Gun.SEA.secret(myKey.epub, myKey);\n                dec = await Gun.SEA.decrypt(v, this.mySecret);\n              }\n            }\n            if (dec !== undefined) {\n              v = dec;\n              encryption = 'Decrypted';\n            } else {\n              encryption = 'Encrypted';\n            }\n          } catch(e) {\n            null;\n          }\n        }\n        const prev = this.children[k] || {};\n        this.children[k] = Object.assign(prev, { value: v, encryption, from });\n        this.setState({children: this.children});\n      }\n    );\n\n    if (this.isGroupRoot) {\n      return;\n    } else if (this.isGroup) {\n      const path = this.props.path.split('/').slice(2).join('/');\n      this.props.gun.map(path, cb); // TODO: make State.group() provide the normal gun api\n    } else {\n      this.getNode().map(cb);\n    }\n  }\n\n  onChildObjectClick(e, k) {\n    e.preventDefault();\n    this.children[k].open = !this.children[k].open;\n    this.setState({children: this.children});\n  }\n\n  onShowMoreClick(e, k) {\n    e.preventDefault();\n    this.children[k].showMore = !this.children[k].showMore;\n    this.setState({children: this.children});\n  }\n\n  renderChildObject(k, displayName) {\n    const path = `${this.props.path  }/${  encodeURIComponent(k)}`;\n    const substr = k.substr(1);\n    return html`\n      <div class=\"explorer-row\" style=\"padding-left: ${this.props.indent}em\">\n        <span onClick=${e => this.onChildObjectClick(e, k)}>${this.state.children[k].open ? chevronDown : chevronRight}</span>\n        <a href=\"/explorer/${encodeURIComponent(path)}\">\n            <b>\n                ${typeof k === 'string' && substr.match(pubKeyRegex) ?\n                        html`<${Name} key=${k} pub=${substr} placeholder=\"user\"/>` :\n                        (displayName || k)}\n            </b>\n        </a>\n        ${Session.getPubKey() === substr ? html`<small class=\"mar-left5\">(you)</small>` : ''}\n      </div>\n      ${this.state.children[k].open ? html`<${ExplorerNode} gun=${this.props.gun} indent=${this.props.indent + 1} key=${path} path=${path} isGroup=${this.props.isGroup}/>` : ''}\n    `;\n  }\n\n  renderChildValue(k, v) {\n    let s;\n    const encryption = this.children[k].encryption;\n    const from = this.children[k].from;\n    const decrypted = encryption === 'Decrypted';\n    const lnk = (href, text, cls) => html`<a class=${cls === undefined ? \"mar-left5\" : cls} href=${href}>${text}</a>`;\n    const keyLinks = html`\n      ${typeof k === 'string' && k.match(hashRegex) ? lnk(`/post/${encodeURIComponent(k)}`, '#') : ''}\n      ${typeof k === 'string' && k.match(pubKeyRegex) ? lnk(`/explorer/Public%2F~${encodeURIComponent(encodeURIComponent(k))}`, html`<${Name} key=${k} pub=${k} placeholder=\"user\"/>`) : ''}\n    `;\n    if (encryption) {\n      if (!decrypted) {\n        s = html`<i>Encrypted value</i>`;\n      } else {\n        s = JSON.stringify(v);\n      }\n    } else {\n      const pub = Session.getPubKey();\n      const path = (this.isMine || this.isLocal) && (`${this.props.path  }/${  encodeURIComponent(k)}`)\n        .replace(`Public/Users/~${  pub  }/`, '')\n        .replace(`Local/`, '');\n\n      if (typeof v === 'string' && v.indexOf('data:image') === 0) {\n        s = this.isMine ? html`<iris-img user=${pub} path=${path}/>` : html`<img src=${v}/>`;\n      } else {\n        let stringified = JSON.stringify(v);\n        let showToggle;\n        if (stringified.length > 100) {\n          showToggle = true;\n          if (!this.state.children[k].showMore) {\n            stringified = stringified.slice(0, 100);\n          }\n        }\n\n        const valueLinks = html`\n          ${typeof v === 'string' && v.match(hashRegex) ? lnk(`/post/${encodeURIComponent(v)}`, '#') : ''}\n          ${k !== 'epub' && typeof v === 'string' && v.match(pubKeyRegex) ? lnk(`/explorer/Public%2F~${encodeURIComponent(encodeURIComponent(v))}`, html`<${Name} key=${v} pub=${v} placeholder=\"user\"/>`) : ''}\n          ${typeof from === 'string' ? html`<small> from ${lnk(`/explorer/Public%2F~${encodeURIComponent(encodeURIComponent(from))}`, html`<${Name} key=${from} pub=${from} placeholder=\"user\"/>`, '')}</small>` : ''}\n        `;\n\n        // TODO: || isGroup where you're participating\n        s = this.isMine || this.isLocal ? html`\n          <${Text} gun=${this.props.gun} placeholder=\"empty\" key=${path} user=${this.isLocal ? null : pub} path=${path} editable=${true} json=${true}/>\n          ${valueLinks}\n        ` :\n        html`\n          <span class=${typeof v === 'string' ? '' : 'iris-non-string'}>\n            ${stringified}\n            ${showToggle ? html`\n              <a onClick=${e => this.onShowMoreClick(e, k)} href=\"\">${this.state.children[k].showMore ? 'less' : 'more'}</a>\n            ` : ''}\n            ${valueLinks}\n          </span>\n        `;\n      }\n    }\n    return html`\n      <div class=\"explorer-row\" style=\"padding-left: ${this.props.indent}em\">\n        <b class=\"val\">${k} ${keyLinks}</b>:\n        ${encryption ? html`\n          <span class=\"tooltip\"><span class=\"tooltiptext\">${encryption} value</span>\n            ${decrypted ? '🔓' : ''}\n          </span>\n        ` : ''} ${s}\n      </div>\n    `;\n  }\n\n  onExpandClicked() {\n    const expandAll = !this.state.expandAll;\n    Object.keys(this.children).forEach(k => {\n      this.children[k].open = expandAll;\n    });\n    this.setState({expandAll, children: this.children});\n  }\n\n  onNewItemSubmit(e) {\n    e.preventDefault();\n    if (this.state.newItemName) {\n      let name = this.state.newItemName.trim();\n      if (this.state.newItemType === 'object') {\n        this.getNode().get(name).put({a:null});\n      } else {\n        this.getNode().get(name).put('');\n      }\n      this.setState({newItemType: false, newItemName: ''});\n    }\n  }\n\n  onNewItemNameInput(e) {\n    this.setState({newItemName: e.target.value.trimStart().replace('  ', ' ')});\n  }\n\n  showNewItemClicked(type) {\n    this.setState({newItemType:type});\n    setTimeout(() => document.querySelector('#newItemNameInput').focus(), 0);\n  }\n\n  render() {\n    const childrenKeys = Object.keys(this.state.children).sort();\n    const myKeyIndex = childrenKeys.indexOf(`~${Session.getPubKey()}`);\n    if (myKeyIndex > 0) {\n      const a = childrenKeys.splice(myKeyIndex, 1);\n      childrenKeys.unshift(a[0]);\n    }\n\n    const renderChildren = children => {\n      return children.map(k => {\n        const v = this.state.children[k].value;\n        const n = this.state.children[k].displayName;\n        if (typeof v === 'object' && v && v['_']) {\n          return this.renderChildObject(k, n);\n        }\n          return this.renderChildValue(k, v);\n\n      });\n    }\n\n    const showMoreBtn = childrenKeys.length > this.state.shownChildrenCount;\n    return html`\n      ${this.props.indent === 0 ? html`\n        <div class=\"explorer-row\" style=\"padding-left: ${this.props.indent}em\">\n          ${this.props.showTools ? html`\n            <p class=\"explorer-tools\">\n              <a onClick=${() => this.onExpandClicked()}>${this.state.expandAll ? 'Close all' : 'Expand all'}</a>\n              <a onClick=${() => this.showNewItemClicked('object')}>New object</a>\n              <a onClick=${() => this.showNewItemClicked('value')}>New value</a>\n              ${childrenKeys.length} items\n            </p>\n          `: ''}\n          ${this.state.newItemType ? html`\n            <p>\n              <form onSubmit=${(e) => this.onNewItemSubmit(e)}>\n                <input id=\"newItemNameInput\" type=\"text\" onInput=${e => this.onNewItemNameInput(e)} value=${this.state.newItemName} placeholder=\"New ${this.state.newItemType} name\"/>\n                <button type=\"submit\">Create</button>\n                <button onClick=${() => this.setState({newItemType: false})}>Cancel</button>\n              </form>\n            </p>\n          ` : ''}\n        </div>\n      `: ''}\n      \n      ${this.isGroupRoot ? Object.keys(this.state.groups).map(group => html`\n          <div class=\"explorer-row\" style=\"padding-left: 1em\">\n              ${chevronRight}\n              <a href=\"/explorer/Group%2F${encodeURIComponent(encodeURIComponent(group))}\"><b>${group}</b></a>\n          </div>\n      `) : renderChildren(childrenKeys.slice(0, this.state.shownChildrenCount))}\n      \n      ${showMoreBtn ? html`\n        <a style=\"padding-left: ${this.props.indent + 1}em\" href=\"\" onClick=${e => {e.preventDefault();this.setState({shownChildrenCount: this.state.shownChildrenCount + SHOW_CHILDREN_COUNT})}}>More (${childrenKeys.length - this.state.shownChildrenCount})</a>\n      ` : ''}\n    `;\n  }\n}\n\nexport default ExplorerNode;","import { html } from 'htm/preact';\nimport State from '../State';\nimport View from './View';\nimport ExplorerNode from '../components/ExplorerNode';\nimport { translate as t } from '../Translation';\nimport Name from '../components/Name';\n\nconst pubKeyRegex = /^[A-Za-z0-9\\-\\_]{40,50}\\.[A-Za-z0-9\\_\\-]{40,50}$/;\n\nconst chevronDown = html`\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" fill=\"currentColor\" class=\"bi bi-chevron-down\" viewBox=\"0 0 16 16\">\n  <path fill-rule=\"evenodd\" d=\"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z\"/>\n</svg>\n`;\n\nconst chevronRight = html`\n<svg width=\"12\" height=\"12\" fill=\"currentColor\" viewBox=\"0 0 16 16\">\n  <path fill-rule=\"evenodd\" d=\"M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z\"/>\n</svg>\n`;\n\nclass Explorer extends View {\n  renderView() {\n    const split = (this.props.node || '').split('/');\n    const scope = split.length && split[0];\n    let gun = State.public;\n    if (scope === 'Local') {\n      gun = State.local;\n    } else if (scope === 'Group') {\n      const group = (split.length >= 2) && split[1];\n      gun = State.group(group || undefined);\n    }\n    const isRootLevel = !split[0].length;\n    const pathString = split.map((k, i) => {\n      k = decodeURIComponent(k);\n      const substr = k.substr(1);\n      const isPubKey = substr.match(pubKeyRegex);\n      return html`\n        ${chevronRight} <a href=\"/explorer/${encodeURIComponent(split.slice(0,i+1).join('/'))}\">\n            ${isPubKey ? html`<${Name} key=${substr} pub=${substr} placeholder=\"profile name\" />` : k}\n        </a>\n        ${isPubKey ? html`<small> (<a href=\"/profile/${substr}\">${t('profile')}</a>)</small>`: ''}\n      `\n    });\n    const s = this.state;\n    return html`\n      <p>\n        <a href=\"/explorer\">All</a> ${split[0].length ? pathString : ''}\n        ${isRootLevel ? html `<small class=\"mar-left5\">Iris raw data.</small>` : ''}\n      </p>\n      ${isRootLevel ? html`\n        <div class=\"explorer-row\">\n            <span onClick=${() => this.setState({publicOpen:!s.publicOpen})}>${s.publicOpen ? chevronDown : chevronRight}</span>\n            <a href=\"/explorer/Public\"><b>Public</b></a>\n            <small class=\"mar-left5\">(synced with peers)</small>\n        </div>\n        ${s.publicOpen ? html`<${ExplorerNode} indent=${1} gun=${State.public} key='Public' path='Public'/>`:''}\n        <div class=\"explorer-row\">\n            <span onClick=${() => this.setState({groupOpen:!s.groupOpen})}>${s.groupOpen ? chevronDown : chevronRight}</span>\n            <a href=\"/explorer/Group\"><b>Group</b></a>\n            <small class=\"mar-left5\">(public data, composite object of all the users in the <a href=\"/explorer/Local%2Fgroups\">group</a>)</small>\n        </div>\n        ${s.groupOpen ? html`<${ExplorerNode} indent=${1} gun=${State.public} key='Group' path='Group'/>`:''}\n        <div class=\"explorer-row\">\n            <span onClick=${() => this.setState({localOpen:!s.localOpen})}>${s.localOpen ? chevronDown : chevronRight}</span>\n            <a href=\"/explorer/Local\"><b>Local</b></a>\n            <small class=\"mar-left5\">(only stored on your device)</small>\n        </div>\n        ${s.localOpen ? html`<${ExplorerNode} indent=${1} gun=${State.local} key=\"Local\" path='Local'/>`:''}\n      `: html`\n        <${ExplorerNode} indent=${0} showTools=${true} gun=${gun} key=${this.props.node} path=${this.props.node}/>\n      `}\n    `;\n  }\n}\n\nexport default Explorer;\n"],"sourceRoot":""}